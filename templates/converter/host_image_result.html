{% extends 'base.html' %}

{% block content %}
<div class="tool-container" style="max-width: 900px;">
    <div class="tool-header">
        <h1>{{ title }}</h1>
        <p>รูปภาพของคุณถูกเก็บไว้ในเซิร์ฟเวอร์สำรองเรียบร้อยแล้ว</p>
    </div>

    <div class="result-card"
        style="background: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-top: 30px; text-align: left;">

        <!-- Preview -->
        <div style="text-align: center; margin-bottom: 40px;">
            <img src="{{ res.direct_link }}" alt="Preview Image"
                style="max-width: 100%; max-height: 400px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);"
                onerror="this.onerror=null; this.src='https://via.placeholder.com/400x300?text=Image+Load+Error'; this.style.border='2px solid red'; alert('โหลดรูปภาพไม่สำเร็จ กรุณาตรวจสอบลิงก์หรือการเชื่อมต่อ');">
            {% if res.expiry %}
            <p style="margin-top: 15px; color: #e5322d; font-weight: 600;">
                <i class="fas fa-history"></i> รูปภาพนี้จะถูกลบอัตโนมัติเมื่อ: {{ res.expiry }}
            </p>
            {% else %}
            <p style="margin-top: 15px; color: #2e7d32; font-weight: 600;">
                <i class="fas fa-check-circle"></i> รูปภาพนี้ถูกเก็บไว้ถาวร
            </p>
            {% endif %}
        </div>

        <!-- Links Grid -->
        <div class="links-section">
            <h3
                style="margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); display: inline-block; padding-bottom: 5px;">
                ลิงก์และโค้ด</h3>

            <div class="link-group">
                <label>Viewer Link</label>
                <div class="copy-box">
                    <input type="text" value="{{ res.viewer_link }}" readonly>
                    <button onclick="copyToClipboard(this)">คัดลอก</button>
                </div>
            </div>

            <div class="link-group">
                <label>Direct Link (ใช้งานในเว็บ)</label>
                <div class="copy-box">
                    <input type="text" value="{{ res.direct_link }}" readonly>
                    <button onclick="copyToClipboard(this)">คัดลอก</button>
                </div>
            </div>

            <div class="link-group">
                <label>HTML Embed</label>
                <div class="copy-box">
                    <input type="text" value="{{ res.codes.html }}" readonly>
                    <button onclick="copyToClipboard(this)">คัดลอก</button>
                </div>
            </div>

            <div class="link-group">
                <label>Markdown (สำหรับ GitHub/Pantip)</label>
                <div class="copy-box">
                    <input type="text" value="{{ res.codes.markdown }}" readonly>
                    <button onclick="copyToClipboard(this)">คัดลอก</button>
                </div>
            </div>

            <div class="link-group">
                <label>BBCode (สำหรับเว็บบอร์ด)</label>
                <div class="copy-box">
                    <input type="text" value="{{ res.codes.bbcode }}" readonly>
                    <button onclick="copyToClipboard(this)">คัดลอก</button>
                </div>
            </div>
        </div>

        <div style="margin-top: 40px; text-align: center;">
            <a href="{% url 'converter:host_image' %}" class="btn btn-secondary">อัพโหลดรูปใหม่</a>
            <a href="{% url 'converter:index' %}" class="btn btn-primary" style="margin-left: 15px;">กลับหน้าหลัก</a>
        </div>
    </div>
</div>

<script>
    function copyToClipboard(btn) {
        const input = btn.parentElement.querySelector('input');
        input.select();
        document.execCommand('copy');

        const originalText = btn.textContent;
        btn.textContent = 'คัดลอกแล้ว!';
        btn.style.background = '#2e7d32';
        btn.style.color = '#fff';

        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '';
            btn.style.color = '';
        }, 2000);
    }
</script>

<style>
    .link-group {
        margin-bottom: 25px;
    }

    .link-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: var(--text-color);
        opacity: 0.8;
    }

    .copy-box {
        display: flex;
        gap: 10px;
    }

    .copy-box input {
        flex: 1;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: rgba(0, 0, 0, 0.02);
        font-family: monospace;
        font-size: 0.85rem;
    }

    .copy-box button {
        padding: 0 20px;
        border-radius: 8px;
        border: none;
        background: var(--primary-color);
        color: #fff;
        cursor: pointer;
        transition: 0.3s;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .copy-box button:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }

    [data-theme='dark'] .copy-box input {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
        color: #fff;
    }
</style>
{% endblock %}